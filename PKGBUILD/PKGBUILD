# Maintainer: Samuobe samuobe@ik.me

pkgname=LibreRecall-git
pkgver=1.0.0
pkgrel=1
pkgdesc="Software to search for what you have seen on the screen recently"
arch=('any')
url="https://github.com/Samuobe/LibreRecall-II"
license=('GPL3')
depends=(
  'python'
  'python-pyqt6'
  'python-pillow'
  'flameshot'
  'tesseract'
)

makedepends=('git' 'python-setuptools')
source=("git+$url.git")
md5sums=('SKIP')

pkgver() {
    cd LibreRecall-II
    git describe --tags --always | sed 's/^v//;s/-/./g'
}

package() {
    # Codice in /usr/share/LibreRecall
    install -d "$pkgdir/usr/share/LibreRecall"
    cp -r "$srcdir/LibreRecall-II/"* "$pkgdir/usr/share/LibreRecall"

    # Wrapper in /usr/bin
    cat >"$pkgdir/usr/bin/LibreRecall" <<'EOF'
    #!/bin/sh
    exec python3 /usr/share/LibreRecall/app.py "$@"
EOF
    chmod 755 "$pkgdir/usr/bin/LibreRecall"

    # Icona
    install -Dm644 "$srcdir/LibreRecall-II/icon.png" "$pkgdir/usr/share/pixmaps/LibreRecall.png"

    # File .desktop
    install -Dm644 "$srcdir/LibreRecall-II/LibreRecall.desktop" "$pkgdir/usr/share/applications/LibreRecall.desktop"

    install -Dm644 "$srcdir/LibreRecall-II/LibreRecall_daemon.desktop" "$pkgdir/etc/xdg/autostart/LibreRecall_daemon.desktop"

}
